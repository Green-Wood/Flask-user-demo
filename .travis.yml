sudo: required
branches:
  only:
  - master
addons:
  apt:
    packages:
    - sshpass
  ssh_konwn_hosts: $SERVER_IP
services:
- docker
before_install:
  - sudo apt-get install -y sshpass
  - docker-compose up --build -d
script:
- docker-compose run api python -m unittest
after_success:
- echo "$DOCKER_PASSWORD" | docker login --username=$DOCKER_ID --password-stdin
- docker-compose push
after_script:
- docker-compose -f docker-compose.yml down
- sshpass -e ssh $SERVER_USER@$SERVER_IP -o stricthostkeychecking=no 'cd ~/flask-user-demo/Flask-user-demo && git pull'
